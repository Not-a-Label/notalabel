<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not a Label - Music Platform for Independent Artists</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .player-bar {
            backdrop-filter: blur(10px);
            background-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <img src="logo-nal.png" alt="Not a Label" class="h-10 w-auto mr-3">
                    <h1 class="text-2xl font-bold">Not a Label</h1>
                </div>
                <nav class="flex items-center space-x-6">
                    <a href="#" onclick="showPage('home')" class="hover:text-purple-400">Home</a>
                    <a href="#" onclick="showPage('tracks')" class="hover:text-purple-400">Tracks</a>
                    <a href="#" onclick="showPage('analytics')" class="hover:text-purple-400">Analytics</a>
                    <a href="#" onclick="showPage('distribution')" class="hover:text-purple-400">Distribution</a>
                    <button id="authBtn" onclick="handleAuth()" class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-700">Login</button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 container mx-auto px-4 py-8">
            <!-- Home Page -->
            <div id="homePage" class="page">
                <div class="text-center py-16">
                    <h2 class="text-5xl font-bold mb-4">Your Music, Your Control</h2>
                    <p class="text-xl text-gray-300 mb-8">The platform for independent musicians to manage their career</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="showPage('login')" class="bg-purple-600 px-8 py-3 rounded-lg text-lg hover:bg-purple-700">Get Started</button>
                        <button onclick="showPage('tracks')" class="bg-gray-700 px-8 py-3 rounded-lg text-lg hover:bg-gray-600">Explore Music</button>
                    </div>
                </div>

                <!-- Features -->
                <div class="grid md:grid-cols-3 gap-8 mt-16">
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="text-3xl mb-4">üìä</div>
                        <h3 class="text-xl font-bold mb-2">Analytics Dashboard</h3>
                        <p class="text-gray-400">Track your streams, revenue, and audience insights in real-time</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="text-3xl mb-4">üéµ</div>
                        <h3 class="text-xl font-bold mb-2">Music Management</h3>
                        <p class="text-gray-400">Upload, organize, and manage your tracks with version control</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <div class="text-3xl mb-4">üöÄ</div>
                        <h3 class="text-xl font-bold mb-2">Distribution</h3>
                        <p class="text-gray-400">Distribute to all major platforms with one click</p>
                    </div>
                </div>
            </div>

            <!-- Login Page -->
            <div id="loginPage" class="page hidden max-w-md mx-auto">
                <h2 class="text-3xl font-bold mb-6">Login</h2>
                <form onsubmit="login(event)">
                    <div class="mb-4">
                        <label class="block mb-2">Email</label>
                        <input type="email" id="loginEmail" value="testartist@example.com" required 
                               class="w-full px-4 py-2 bg-gray-800 rounded border border-gray-700 focus:border-purple-500 focus:outline-none">
                    </div>
                    <div class="mb-6">
                        <label class="block mb-2">Password</label>
                        <input type="password" id="loginPassword" value="password123" required 
                               class="w-full px-4 py-2 bg-gray-800 rounded border border-gray-700 focus:border-purple-500 focus:outline-none">
                    </div>
                    <button type="submit" class="w-full bg-purple-600 py-2 rounded hover:bg-purple-700">Login</button>
                </form>
                <p class="mt-4 text-center text-gray-400">
                    Don't have an account? <a href="#" onclick="showPage('register')" class="text-purple-400 hover:underline">Register</a>
                </p>
            </div>

            <!-- Tracks Page -->
            <div id="tracksPage" class="page hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Music Library</h2>
                    <button onclick="showUploadModal()" class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-700">Upload Track</button>
                </div>
                <div id="tracksList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Tracks will be loaded here -->
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analyticsPage" class="page hidden">
                <h2 class="text-3xl font-bold mb-6">Analytics Dashboard</h2>
                
                <!-- Stats Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-gray-400 text-sm">Total Streams</h3>
                        <p class="text-3xl font-bold mt-2">125,430</p>
                        <p class="text-green-400 text-sm mt-2">+15.3% from last month</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-gray-400 text-sm">Revenue</h3>
                        <p class="text-3xl font-bold mt-2">$543.21</p>
                        <p class="text-green-400 text-sm mt-2">+8.7% from last month</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-gray-400 text-sm">Monthly Listeners</h3>
                        <p class="text-3xl font-bold mt-2">45,320</p>
                        <p class="text-green-400 text-sm mt-2">+12.5% from last month</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-gray-400 text-sm">Active Tracks</h3>
                        <p class="text-3xl font-bold mt-2">15</p>
                        <p class="text-gray-400 text-sm mt-2">Across 4 platforms</p>
                    </div>
                </div>

                <!-- Platform Breakdown -->
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4">Platform Breakdown</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üéµ</span>
                                <span>Spotify</span>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">85,234 streams</p>
                                <p class="text-sm text-gray-400">68% of total</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üçé</span>
                                <span>Apple Music</span>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">25,643 streams</p>
                                <p class="text-sm text-gray-400">20% of total</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üì∫</span>
                                <span>YouTube Music</span>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">14,553 streams</p>
                                <p class="text-sm text-gray-400">12% of total</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Distribution Page -->
            <div id="distributionPage" class="page hidden">
                <h2 class="text-3xl font-bold mb-6">Distribution</h2>
                
                <div class="bg-gray-800 p-6 rounded-lg mb-6">
                    <h3 class="text-xl font-bold mb-4">Connected Platforms</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="border border-gray-700 p-4 rounded flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üéµ</span>
                                <div>
                                    <p class="font-bold">Spotify</p>
                                    <p class="text-sm text-green-400">Connected</p>
                                </div>
                            </div>
                            <button class="text-sm text-gray-400 hover:text-white">Manage</button>
                        </div>
                        <div class="border border-gray-700 p-4 rounded flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üçé</span>
                                <div>
                                    <p class="font-bold">Apple Music</p>
                                    <p class="text-sm text-gray-400">Not connected</p>
                                </div>
                            </div>
                            <button class="text-sm text-purple-400 hover:text-purple-300">Connect</button>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4">Quick Distribute</h3>
                    <select class="w-full mb-4 px-4 py-2 bg-gray-700 rounded border border-gray-600">
                        <option>Select a track to distribute</option>
                        <option>Summer Vibes</option>
                        <option>Night Drive</option>
                        <option>Ocean Dreams</option>
                    </select>
                    <div class="grid md:grid-cols-4 gap-3 mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2" checked> Spotify
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2"> Apple Music
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2" checked> YouTube Music
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2"> SoundCloud
                        </label>
                    </div>
                    <button class="bg-purple-600 px-6 py-2 rounded hover:bg-purple-700">Distribute Now</button>
                </div>
            </div>
        </main>

        <!-- Music Player Bar -->
        <div id="playerBar" class="player-bar fixed bottom-0 left-0 right-0 p-4 hidden">
            <div class="container mx-auto flex items-center justify-between">
                <div class="flex items-center">
                    <img id="playerCover" src="https://via.placeholder.com/48" alt="Cover" class="w-12 h-12 rounded mr-4">
                    <div>
                        <p id="playerTitle" class="font-bold">Track Title</p>
                        <p id="playerArtist" class="text-sm text-gray-400">Artist Name</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="togglePlay()" id="playBtn">‚ñ∂Ô∏è</button>
                    <audio id="audioPlayer" class="hidden"></audio>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let authToken = localStorage.getItem('token');
        const API_URL = 'http://localhost:4000';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (authToken) {
                checkAuth();
            }
            showPage('home');
        });

        // Page navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            const pageEl = document.getElementById(page + 'Page');
            if (pageEl) {
                pageEl.classList.remove('hidden');
            }

            // Load page-specific content
            if (page === 'tracks' && authToken) {
                loadTracks();
            } else if (page === 'analytics' && authToken) {
                // Analytics already has mock data
            }
        }

        // Authentication
        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (data.success) {
                    authToken = data.token;
                    localStorage.setItem('token', authToken);
                    currentUser = data.user;
                    updateAuthUI();
                    showPage('tracks');
                    alert('Login successful!');
                } else {
                    alert(data.message || 'Login failed');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function checkAuth() {
            try {
                const response = await fetch(`${API_URL}/api/auth/verify`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    updateAuthUI();
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('token');
            updateAuthUI();
            showPage('home');
        }

        function handleAuth() {
            if (authToken) {
                logout();
            } else {
                showPage('login');
            }
        }

        function updateAuthUI() {
            const authBtn = document.getElementById('authBtn');
            if (authToken && currentUser) {
                authBtn.textContent = 'Logout';
            } else {
                authBtn.textContent = 'Login';
            }
        }

        // Load tracks
        async function loadTracks() {
            try {
                const response = await fetch(`${API_URL}/api/music/tracks`);
                const data = await response.json();

                const tracksList = document.getElementById('tracksList');
                tracksList.innerHTML = '';

                // Add mock tracks if none exist
                const tracks = data.tracks.length > 0 ? data.tracks : [
                    { id: '1', title: 'Summer Vibes', artist_name: 'DJ Johnny', play_count: 12543 },
                    { id: '2', title: 'Night Drive', artist_name: 'DJ Johnny', play_count: 8234 },
                    { id: '3', title: 'Ocean Dreams', artist_name: 'Jane & The Waves', play_count: 15678 }
                ];

                tracks.forEach(track => {
                    const trackEl = document.createElement('div');
                    trackEl.className = 'bg-gray-800 p-4 rounded-lg hover:bg-gray-700 cursor-pointer';
                    trackEl.innerHTML = `
                        <img src="https://via.placeholder.com/200" alt="${track.title}" class="w-full h-48 object-cover rounded mb-4">
                        <h3 class="font-bold mb-1">${track.title}</h3>
                        <p class="text-sm text-gray-400 mb-2">${track.artist_name}</p>
                        <p class="text-sm text-gray-500">${track.play_count.toLocaleString()} plays</p>
                    `;
                    trackEl.onclick = () => playTrack(track);
                    tracksList.appendChild(trackEl);
                });
            } catch (error) {
                console.error('Failed to load tracks:', error);
            }
        }

        // Music player
        function playTrack(track) {
            document.getElementById('playerTitle').textContent = track.title;
            document.getElementById('playerArtist').textContent = track.artist_name;
            document.getElementById('playerBar').classList.remove('hidden');
            
            // Record play
            if (authToken) {
                fetch(`${API_URL}/api/music/tracks/${track.id}/play`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
            }
        }

        function togglePlay() {
            const playBtn = document.getElementById('playBtn');
            playBtn.textContent = playBtn.textContent === '‚ñ∂Ô∏è' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        function showUploadModal() {
            alert('Upload functionality would open here. For now, use the API directly.');
        }
    </script>
</body>
</html>